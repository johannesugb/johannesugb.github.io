---
title: "JavaScript Test"
# last_modified_at: 2021-03-02T19:00:00+01:00
categories:
#  - Vulkan
tags:
#  - Vulkan
#  - synchronization
# header:
#   image: /assets/images/1500x500.jpg
---

<h1 style="color:green;">
    GeeksForGeeks
</h1>

<p> 
    <!-- Making a text input -->
    <input type="number" step="any" id="inputVal" placeholder="Float" /> 
          
    <!-- Button to send data -->
    <button id="sendButton" onclick="sendJSON()">Send JSON</button> 
  
  
    <!-- For printing result from server -->
    <p class="result" style="color:green"></p>   
    
    <div>
      <canvas id="myChart"></canvas>
   </div>
</p>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function sendJSON(){ 

			let inputVal = document.getElementById("inputVal").value;
			// Validate inputVal 
			var patternForInputVal=/^-?(\d+(\.\d+)?|\.\d+)$/;
			if (!patternForInputVal.test(inputVal)) {
				alert("Invalid number in textbox: " + inputVal);
				return;
			}
		
			let result = document.getElementById("resultBox");
			let name = document.querySelector('#name'); 
			let email = document.querySelector('#email'); 
			
			// Creating a XHR object 
			let xhr = new XMLHttpRequest(); 
			let url = "https://godbolt.org/api/compiler/g63/compile"; 
		
			// open a connection 
			xhr.open("POST", url, true); 

			// Set the request header i.e. which type of content you are sending 
			xhr.setRequestHeader("Content-Type", "application/json"); 

			// Create a state change callback 
			xhr.onreadystatechange = function () { 
			
				document.getElementById("sendButton").disabled=false;
			
				if (xhr.readyState === 4 && xhr.status === 200) { 

					// Analyze server result:
					var location = this.responseText.lastIndexOf("####RESULT:");
					if (-1 == location) {
						result.innerHTML = this.responseText; 
					}
					else {
						// Got something that looks like our expected result:
						const resultLines = this.responseText.substring(location + "####RESULT:".length).split("\n");
						if (resultLines.length >= 1) {
							result.innerHTML = resultLines[0];
							
							// Results for chart in lines [1] and [2]:
							if (resultLines.length >= 3) {
								const labels = resultLines[1].split(",");
								const precisions = resultLines[2].split(",").map(x => parseFloat(x));

								const data = {
									labels: labels,
									datasets: [{
									  label: 'Precision',
									  backgroundColor: 'rgb(255, 99, 132)',
									  borderColor: 'rgb(255, 99, 132)',
									  data: precisions,
									}]
								  };

								const config = {
									type: 'line',
									data: data,
									options: {}
								  };
								
								const myChart = new Chart(
									document.getElementById('myChart'),
									config
								  );
							}
						}
					}
				} 
			}; 
			
var cppCode = 
"#include <iostream>                                                                       \n" +
"#include <algorithm>                                                                      \n" +
"float precision_for(float reference) {                                                    \n" +
"	unsigned long long i = *reinterpret_cast<unsigned long long*>(&reference);             \n" +
"    unsigned long long j = i+1;                                                           \n" +
"    float more = *reinterpret_cast<float*>(&j);                                           \n" +
"	unsigned long long k = i-1;                                                            \n" +
"	float less = *reinterpret_cast<float*>(&k);                                            \n" +
"    float precision = std::max(more - reference, reference - less);                       \n" +
"	return precision;                                                                      \n" +
"}                                                                                         \n" +
"int main () {                                                                             \n" +
"    float middle = static_cast<float>({INPUTVAL});                                        \n" +
"    float step = static_cast<float>(1);                                                   \n" +
"    std::cout << \"####RESULT:\" << std::defaultfloat << precision_for(middle) << std::endl;\n" +
"    std::cout << std::fixed;                                                              \n" +
"    for (int i = -10; i < 10; ++i) {                                                      \n" +
"        float val = middle + static_cast<float>(i) * step;                                \n" +
"        std::cout << val << ",";                                                          \n" +
"    }                                                                                     \n" +
"    std::cout << (middle + static_cast<float>(10) * step) << std::endl;                   \n" +
"    std::cout << std::defaultfloat;                                                       \n" +
"    for (int i = -10; i < 10; ++i) {                                                      \n" +
"        float val = middle + static_cast<float>(i) * step;                                \n" +
"        std::cout << precision_for(val) << ",";                                           \n" +
"    }                                                                                     \n" +
"    std::cout << precision_for(middle + static_cast<float>(10) * step) << std::endl;      \n" +
"    return 1;                                                                             \n" +
"}                                                                                         \n"

			// Converting JSON data to string 
			var data = JSON.stringify({
    "source": cppCode.replace("{INPUTVAL}", inputVal),
    "compiler": "g82",
    "options": {
        "userArguments": "-O3",
        "executeParameters": {
            "args": ["arg1", "arg2"],
            "stdin": "hello, world!"
        },
        "compilerOptions": {
            "executorRequest": true
        },
        "filters": {
            "execute": true
        },
        "tools": [],
        "libraries": [
            {"id": "openssl", "version": "111c"}
        ]
    },
    "lang": "c++",
    "allowStoreCodeDebug": true
}); 

			// Sending data with the request 
			xhr.send(data); 

            document.getElementById("sendButton").disabled=true;
		} 

</script>

